(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     14181,        412]
NotebookOptionsPosition[     13000,        383]
NotebookOutlinePosition[     13468,        401]
CellTagsIndexPosition[     13425,        398]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
      "Compute", " ", "Jacobian", " ", "of", " ", "ODE", " ", "system", " ", 
       "with", " ", "eqs", " ", "S1"}], " ", "-", " ", 
      RowBox[{"S5", " ", "from", " ", "Martinez2012", "\n", "\n", 
       RowBox[{"References", ":", "\n", "https", ":"}]}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"resources", ".", "wolframcloud", ".", "com"}], "/", 
         "FunctionRepository"}], "/", "resources"}], "/", "JacobianMatrix"}], 
      "/", "\n", 
      RowBox[{"https", ":"}]}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "5790"}], "/", "how"}], "-", "to", "-", "make", 
     "-", "jacobian", "-", "automatically", "-", "in", "-", "mathematica"}]}],
    "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dissociation", "[", 
      RowBox[{"k_", ",", " ", "ui_"}], "]"}], " ", ":=", " ", 
     FractionBox[
      SuperscriptBox["k", "2"], 
      RowBox[{
       SuperscriptBox["k", "2"], "+", 
       SuperscriptBox["ui", "2"]}]]}], " ", ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"protein", "[", 
      RowBox[{"k_", ",", " ", "ui_"}], "]"}], " ", ":=", " ", 
     FractionBox[
      SuperscriptBox["ui", "2"], 
      RowBox[{
       SuperscriptBox["k", "2"], "+", 
       SuperscriptBox["ui", "2"]}]]}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.904271728302062*^9, 3.9042719320707893`*^9}, {
  3.9042720028158197`*^9, 3.904272010827848*^9}, {3.904272260192325*^9, 
  3.904272309856645*^9}, {3.904272448451641*^9, 3.904272449738186*^9}, {
  3.904272602818716*^9, 3.9042727059340982`*^9}, {3.904273587913485*^9, 
  3.904273592241206*^9}, {3.904273819237776*^9, 3.9042738193893633`*^9}, {
  3.904273915932643*^9, 3.9042739268179607`*^9}, {3.904452869782648*^9, 
  3.90445294861455*^9}, {3.904454311435685*^9, 3.904454314163971*^9}},
 CellLabel->"In[77]:=",ExpressionUUID->"2d535807-d0df-4855-a8ee-8c2d9dfb7c18"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Equations", " ", "S1"}], " ", "-", " ", 
    RowBox[{"S5", " ", "in", " ", "Martinez2012", "\n", "\n", 
     RowBox[{"NOTE", ":", " ", 
      RowBox[{
      "I", " ", "use", " ", "capital", " ", "subscripts", " ", "to", " ", 
       "avoid", " ", "mathematica", " ", "treating", " ", "subscripts", " ", 
       "as", " ", "state", " ", "vars"}]}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"bcr0", " ", "=", " ", 
     RowBox[{"bcr0MaxSignal", "*", 
      RowBox[{"PDF", "[", 
       RowBox[{
        RowBox[{"NormalDistribution", "[", "\n", "\t", 
         RowBox[{
         "bcr0MaxSignalCenteredOnTimestep", ",", " ", "\n", "\t", 
          "bcr0MaxSignalTimestepStd"}], "]"}], ",", " ", "t"}], "]"}]}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"BCR", " ", "=", " ", 
     RowBox[{"bcr0", "*", 
      RowBox[{"dissociation", "[", 
       RowBox[{"kb", ",", " ", "b"}], "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"cd0", " ", "=", " ", 
     RowBox[{"cd0MaxSignal", "*", 
      RowBox[{"PDF", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"NormalDistribution", "[", "\n", "\t", 
         RowBox[{
         "cd0MaxSignalCenteredOnTimestep", ",", " ", "\n", "\t", 
          "cd0MaxSignalTimestepStd"}], "]"}], ",", " ", "t"}], "]"}]}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"CD40", " ", "=", " ", 
     RowBox[{"cd0", "*", 
      RowBox[{"dissociation", "[", 
       RowBox[{"kb", ",", " ", "b"}], "]"}]}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"u", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"p", ",", " ", "b", ",", " ", "r"}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"ds", " ", "=", " ", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"\[Mu]p", " ", "+", " ", 
        RowBox[{"\[Sigma]p", "*", 
         RowBox[{"dissociation", "[", 
          RowBox[{"kb", ",", " ", "b"}], "]"}]}], " ", "+", " ", 
        RowBox[{"\[Sigma]p", "*", 
         RowBox[{"protein", "[", 
          RowBox[{"kr", ",", " ", "r"}], "]"}]}], " ", "-", " ", 
        RowBox[{"\[Lambda]p", "*", "p"}]}], ",", "\n", "\t", 
       RowBox[{"\[Mu]b", " ", "+", " ", 
        RowBox[{"\[Sigma]b", "*", 
         RowBox[{"dissociation", "[", 
          RowBox[{"kp", ",", " ", "p"}], "]"}], "*", 
         RowBox[{"dissociation", "[", 
          RowBox[{"kb", ",", " ", "b"}], "]"}], "*", "\n", "\t\t", 
         RowBox[{"dissociation", "[", 
          RowBox[{"kr", ",", " ", "r"}], "]"}]}], " ", "-", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Lambda]b", " ", "+", " ", "BCR"}], ")"}], "*", "b"}]}], 
       ",", "\n", "\t", 
       RowBox[{"\[Mu]r", " ", "+", " ", 
        RowBox[{"\[Sigma]r", "*", 
         RowBox[{"protein", "[", 
          RowBox[{"kr", ",", " ", "r"}], "]"}]}], " ", "+", " ", "CD40", " ", 
        "-", " ", 
        RowBox[{"\[Lambda]r", "*", "r"}]}]}], "\n", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"jacobianDs", " ", "=", " ", 
     RowBox[{"Grad", "[", 
      RowBox[{"ds", ",", " ", "u"}], "]"}]}], ";"}]}]}]], "Code",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQ/eeCxYlzYm8dy6IFLoDo/iMhT0A0l7zlBxA9w/HL
NxC9be+KfyD6XwMT93kgXV52VhRE80Xd1gDRBUrsWiC6g+9/HojuvRyVD6K3
zTEtB9ESXKKVIPpNpFYtiJ59dW0TiI4wO9IGov/fmt4BooOVGyeC1S/OnwKi
2zfnzATRkgJzd4Poac8qDoLowqLUQyC6jHuNtrr4W8dI4/06IFrGYNJVEO0Q
Y3odROso7P4Golfa5XwH0bEca8U4Jd86bjHfLweitxmuUgLRTR9fKYNoRmU2
AxAtefKMKYiepG9rA6J5/8zwA9Fi2w6Eg+iGLeviQPSqp9+SQHSuTHgBiAYA
rl+a2Q==
  "],
 CellLabel->
  "In[238]:=",ExpressionUUID->"a004510c-94f1-454e-820d-9f6bbfe2de8e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"jacobianDs", "[", 
  RowBox[{"[", "1", "]"}], "]"}]], "Code",
 CellChangeTimes->{{3.9054406459929543`*^9, 3.905440653281046*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"3904ab34-d6fd-488c-a93c-e069366ac55d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "\[Lambda]p"}], ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"2", " ", "b", " ", 
      SuperscriptBox["kb", "2"], " ", "\[Sigma]p"}], 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["b", "2"], "+", 
        SuperscriptBox["kb", "2"]}], ")"}], "2"]]}], ",", 
   RowBox[{
    RowBox[{"-", 
     FractionBox[
      RowBox[{"2", " ", 
       SuperscriptBox["r", "3"], " ", "\[Sigma]p"}], 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["kr", "2"], "+", 
         SuperscriptBox["r", "2"]}], ")"}], "2"]]}], "+", 
    FractionBox[
     RowBox[{"2", " ", "r", " ", "\[Sigma]p"}], 
     RowBox[{
      SuperscriptBox["kr", "2"], "+", 
      SuperscriptBox["r", "2"]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{3.905440662534555*^9},
 CellLabel->
  "Out[247]=",ExpressionUUID->"9e71aafb-5639-4349-9f9f-49312f40df2e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"jacobianDs", "[", 
  RowBox[{"[", "2", "]"}], "]"}]], "Code",
 CellChangeTimes->{{3.905440657384624*^9, 3.905440659553211*^9}},
 CellLabel->
  "In[248]:=",ExpressionUUID->"c6d833de-fe77-48b8-bef9-5ed5332e1c5c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    FractionBox[
     RowBox[{"2", " ", 
      SuperscriptBox["kb", "2"], " ", 
      SuperscriptBox["kp", "2"], " ", 
      SuperscriptBox["kr", "2"], " ", "p", " ", "\[Sigma]b"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["b", "2"], "+", 
        SuperscriptBox["kb", "2"]}], ")"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["kp", "2"], "+", 
         SuperscriptBox["p", "2"]}], ")"}], "2"], " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["kr", "2"], "+", 
        SuperscriptBox["r", "2"]}], ")"}]}]]}], ",", 
   RowBox[{
    FractionBox[
     RowBox[{
      SqrtBox["2"], " ", 
      SuperscriptBox["b", "2"], " ", "bcr0MaxSignal", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"-", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "bcr0MaxSignalCenteredOnTimestep"}], "+", "t"}], 
           ")"}], "2"], 
         RowBox[{"2", " ", 
          SuperscriptBox["bcr0MaxSignalTimestepStd", "2"]}]]}]], " ", 
      SuperscriptBox["kb", "2"]}], 
     RowBox[{"bcr0MaxSignalTimestepStd", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["b", "2"], "+", 
         SuperscriptBox["kb", "2"]}], ")"}], "2"], " ", 
      SqrtBox["\[Pi]"]}]], "-", 
    FractionBox[
     RowBox[{"bcr0MaxSignal", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"-", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "bcr0MaxSignalCenteredOnTimestep"}], "+", "t"}], 
           ")"}], "2"], 
         RowBox[{"2", " ", 
          SuperscriptBox["bcr0MaxSignalTimestepStd", "2"]}]]}]], " ", 
      SuperscriptBox["kb", "2"]}], 
     RowBox[{"bcr0MaxSignalTimestepStd", " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["b", "2"], "+", 
        SuperscriptBox["kb", "2"]}], ")"}], " ", 
      SqrtBox[
       RowBox[{"2", " ", "\[Pi]"}]]}]], "-", "\[Lambda]b", "-", 
    FractionBox[
     RowBox[{"2", " ", "b", " ", 
      SuperscriptBox["kb", "2"], " ", 
      SuperscriptBox["kp", "2"], " ", 
      SuperscriptBox["kr", "2"], " ", "\[Sigma]b"}], 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["b", "2"], "+", 
         SuperscriptBox["kb", "2"]}], ")"}], "2"], " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["kp", "2"], "+", 
        SuperscriptBox["p", "2"]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["kr", "2"], "+", 
        SuperscriptBox["r", "2"]}], ")"}]}]]}], ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"2", " ", 
      SuperscriptBox["kb", "2"], " ", 
      SuperscriptBox["kp", "2"], " ", 
      SuperscriptBox["kr", "2"], " ", "r", " ", "\[Sigma]b"}], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["b", "2"], "+", 
        SuperscriptBox["kb", "2"]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["kp", "2"], "+", 
        SuperscriptBox["p", "2"]}], ")"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["kr", "2"], "+", 
         SuperscriptBox["r", "2"]}], ")"}], "2"]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{3.905440670118823*^9},
 CellLabel->
  "Out[248]=",ExpressionUUID->"5a63f6b6-f87c-4e25-a932-8e11b54080f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"jacobianDs", "[", 
  RowBox[{"[", "3", "]"}], "]"}]], "Code",
 CellChangeTimes->{{3.905440671424777*^9, 3.90544067348107*^9}},
 CellLabel->
  "In[249]:=",ExpressionUUID->"62555261-ace0-4902-90e5-9759a50b879a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{
      SqrtBox["2"], " ", "b", " ", "cd0MaxSignal", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"-", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "cd0MaxSignalCenteredOnTimestep"}], "+", "t"}], 
           ")"}], "2"], 
         RowBox[{"2", " ", 
          SuperscriptBox["cd0MaxSignalTimestepStd", "2"]}]]}]], " ", 
      SuperscriptBox["kb", "2"]}], 
     RowBox[{"cd0MaxSignalTimestepStd", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["b", "2"], "+", 
         SuperscriptBox["kb", "2"]}], ")"}], "2"], " ", 
      SqrtBox["\[Pi]"]}]]}], ",", 
   RowBox[{
    RowBox[{"-", "\[Lambda]r"}], "-", 
    FractionBox[
     RowBox[{"2", " ", 
      SuperscriptBox["r", "3"], " ", "\[Sigma]r"}], 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["kr", "2"], "+", 
        SuperscriptBox["r", "2"]}], ")"}], "2"]], "+", 
    FractionBox[
     RowBox[{"2", " ", "r", " ", "\[Sigma]r"}], 
     RowBox[{
      SuperscriptBox["kr", "2"], "+", 
      SuperscriptBox["r", "2"]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.90544065372357*^9, 3.905440673969092*^9}},
 CellLabel->
  "Out[249]=",ExpressionUUID->"d14c4250-5aab-42f5-bac0-a262228b01c4"]
}, Open  ]]
},
WindowSize->{718.5, 758.25},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>1.3 Inherited,
FrontEndVersion->"13.2 for Linux x86 (64-bit) (January 31, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"a6d1154e-ef8a-499f-afff-649247322f0d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2176, 54, 340, "Code",ExpressionUUID->"2d535807-d0df-4855-a8ee-8c2d9dfb7c18"],
Cell[2737, 76, 3596, 90, 614, "Code",ExpressionUUID->"a004510c-94f1-454e-820d-9f6bbfe2de8e"],
Cell[CellGroupData[{
Cell[6358, 170, 236, 5, 66, "Code",ExpressionUUID->"3904ab34-d6fd-488c-a93c-e069366ac55d"],
Cell[6597, 177, 944, 30, 75, "Output",ExpressionUUID->"9e71aafb-5639-4349-9f9f-49312f40df2e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7578, 212, 234, 5, 66, "Code",ExpressionUUID->"c6d833de-fe77-48b8-bef9-5ed5332e1c5c"],
Cell[7815, 219, 3495, 107, 394, "Output",ExpressionUUID->"5a63f6b6-f87c-4e25-a932-8e11b54080f4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11347, 331, 233, 5, 66, "Code",ExpressionUUID->"62555261-ace0-4902-90e5-9759a50b879a"],
Cell[11583, 338, 1401, 42, 163, "Output",ExpressionUUID->"d14c4250-5aab-42f5-bac0-a262228b01c4"]
}, Open  ]]
}
]
*)

